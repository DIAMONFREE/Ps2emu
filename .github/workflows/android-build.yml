name: Build Play! – SIDO Edition

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-android:
    runs-on: ubuntu-latest

    steps:
      # ----- 1. سحب الملفات -----
      - name: Checkout repository
        uses: actions/checkout@v3

      # ----- 2. فك ضغط ZIP -----
      - name: Unzip Project
        run: |
          mkdir project
          unzip Play-SIDO-Edition.zip -d project

      # ----- 3. إعداد Java -----
      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'

      # ----- 4. تنزيل Android NDK -----
      - name: Download Android NDK
        run: |
          wget https://dl.google.com/android/repository/android-ndk-r25b-linux.zip
          unzip android-ndk-r25b-linux.zip
          export ANDROID_NDK_HOME=$PWD/android-ndk-r25b
          echo "ANDROID_NDK_HOME=$ANDROID_NDK_HOME" >> $GITHUB_ENV

      # ----- 5. تثبيت CMake -----
      - name: Install CMake
        run: sudo apt-get install -y cmake

      # ----- 6. بناء APK -----
      - name: Build APK
        run: |
          cd project
          mkdir build
          cd build
          cmake ../ -DANDROID_ABI=arm64-v8a -DANDROID_PLATFORM=android-31 -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK_HOME/build/cmake/android.toolchain.cmake
          make -j$(nproc)

      # ----- 7. حفظ نتائج البناء -----
      - name: Upload APK
        uses: actions/upload-artifact@v3
        with:
          name: PlaySIDO-APK
          path: project/build
